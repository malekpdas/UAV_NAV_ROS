# Hybrid EKF+AHRS Configuration

/ekf2_node:
  ros__parameters:
    # Frame IDs
    map_frame: 'map'
    odom_frame: 'odom'
    base_link_frame: 'base_link'
    
    # ========================================
    # AHRS (Madgwick) Parameters
    # ========================================
    # Higher gain = faster convergence but more noise
    # Lower gain = slower convergence but smoother
    ahrs_gain: 0.5
    
    # Acceleration rejection threshold (degrees)
    # Rejects accel updates when device acceleration exceeds this
    # Typical: 10-20 degrees
    ahrs_accel_rejection: 10.0
    
    # Magnetic rejection threshold (degrees)
    # Rejects mag updates when magnetic disturbance detected
    # Typical: 10-20 degrees
    ahrs_mag_rejection: 10.0
    
    # ========================================
    # EKF Noise Parameters
    # ========================================
    
    # Gyroscope bias random walk (rad/s²/√Hz)
    gyro_bias_random_walk: 1.0e-3
    
    # Accelerometer bias random walk (m/s³/√Hz)
    accel_bias_random_walk: 5.0e-3
    
    # Magnetometer bias random walk (uT/√Hz or 1/√Hz)
    mag_bias_random_walk: 1.0e-3
    
    # ========================================
    # Innovation Gate Thresholds (NIS)
    # ========================================
    # Chi-squared thresholds for outlier rejection
    # 3 DOF: 11.3 (99%), 9.35 (97.5%), 7.81 (95%)
    gate_pos_nis: 1e9    # Position (3-DOF)
    gate_vel_nis: 1e9    # Velocity (3-DOF)
    gate_heading_nis: 1e9 # Heading (1-DOF, ~99.7%)
    
    # ========================================
    # GPS Heading Parameters
    # ========================================
    # Minimum ground speed for GPS heading update (m/s)
    yaw_speed_threshold: 20.0
    
    # Base GPS heading noise (rad)
    gps_heading_noise: 0.1
    
    # ========================================
    # Magnetometer Reference
    # ========================================
    # True North magnetic field vector in NED frame
    # This should be the normalized local magnetic field
    # Example for Northern Hemisphere:
    # - Magnetic declination: ~10° East → [cos(10°), sin(10°), 0]
    # - With inclination: adjust Z component
    mag_ref_ned: [0.64917977, -0.09156606, 0.75510349]
